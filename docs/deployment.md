# Документация по деплою

## Обзор

Проект деплоится в Яндекс Облако как бессерверная функция. Используется GitHub Actions для автоматического деплоя.

## Конфигурация

### 1. Тестовая среда
- Файл: `.github/workflows/yacloud-func-python.yml`
- Триггер: push в master/main или pull request
- Имя функции: `alice-chess-testing`
- Память: 2048MB

### 2. Продакшен среда
- Файл: `.github/workflows/yacloud-func-python prod.yml`
- Триггер: ручной запуск (workflow_dispatch)
- Имя функции: `alice-chess-stable`
- Память: 4096MB

## Переменные окружения

### Необходимые секреты
- `YC_SA_JSON_CREDENTIALS` - JSON-ключ сервисного аккаунта Яндекс Облака
- `FOLDER_ID` - ID папки в Яндекс Облаке
- `CHESS_API_KEY` - ключ API для шахматного движка

## Структура деплоя

### Включаемые файлы
```
include: |
  *.py
  handlers/*.py
  request_validators/*.py
  requirements.txt
```

### Исключаемые файлы
```
exclude: |
  **/*.ts
  **/tests/**
  **/_prev-stable/**
  tests/
  _prev-stable/
  .github/**
  venv/**
  .gitignore
  LICENSE
```

## Процесс деплоя

1. GitHub Actions запускает workflow
2. Код клонируется из репозитория
3. Создается архив с нужными файлами
4. Архив загружается в Яндекс Облако
5. Функция обновляется

## Мониторинг

### Логи
- Доступны в консоли Яндекс Облака
- Путь: Функции -> alice-chess-testing/stable -> Логи

### Метрики
- Количество вызовов
- Время выполнения
- Ошибки
- Использование памяти

## Откат изменений

1. В консоли Яндекс Облака:
   - Функции -> alice-chess-stable
   - Версии
   - Выбрать предыдущую версию
   - Сделать активной

2. Или через GitHub:
   - Откатить коммит
   - Запустить деплой вручную

## Требования к окружению

- Python 3.9
- Зависимости из requirements.txt
- Доступ к API Яндекс Облака
- Доступ к шахматному API

## Устранение неполадок

### 1. Функция не деплоится
- Проверить секреты в GitHub
- Проверить права сервисного аккаунта
- Проверить логи GitHub Actions

### 2. Функция не работает
- Проверить логи в Яндекс Облаке
- Проверить переменные окружения
- Проверить доступ к API

### 3. Проблемы с памятью
- Увеличить лимит памяти
- Оптимизировать код
- Проверить утечки памяти 